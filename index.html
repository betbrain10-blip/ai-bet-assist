<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AI Bet Assist</title>
<style>
:root{
  --bg1:#f6f7fb; --bg2:#eef7ff; --bg3:#f7f0ff;
  --ink:#0b1220; --muted:#5f6b85;
  --card:#ffffff; --border:#e6e9f2;
  --grad:linear-gradient(90deg,#4f46e5,#06b6d4);
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));color:var(--ink)}
.wrap{max-width:920px;margin:auto;padding:18px}
.card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px;margin:12px 0;box-shadow:0 10px 25px rgba(0,0,0,.08)}
.badge{display:inline-block;padding:6px 12px;border-radius:999px;font-size:12px;font-weight:900;background:#eef2ff;color:#4338ca}
h1{margin:10px 0 4px;font-size:22px}
h2{margin:0 0 10px;font-size:16px}
.sub{font-size:14px;color:var(--muted);line-height:1.35}
.small{font-size:12px;color:var(--muted)}
.note{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.35}
.row{display:flex;gap:10px;flex-wrap:wrap}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
.actions a{flex:1;min-width:160px;text-align:center;padding:12px;border-radius:14px;border:1px solid var(--border);text-decoration:none;font-weight:900;color:var(--ink);background:#fff}
button{padding:11px 12px;border:none;border-radius:14px;background:var(--grad);color:#fff;font-size:14px;font-weight:900;cursor:pointer}
.btnLight{background:#fff;color:var(--ink);border:1px solid var(--border)}
.pill{display:inline-block;padding:6px 10px;border-radius:999px;background:#f3f4f6;border:1px solid var(--border);font-size:12px;font-weight:900}
.table{width:100%;border-collapse:separate;border-spacing:0 8px}
.table th{text-align:left;font-size:12px;color:var(--muted);font-weight:900;padding:0 8px}
.tr{background:#fff;border:1px solid var(--border);border-radius:14px}
.table td{padding:10px 8px;vertical-align:top}
.footer{text-align:center;font-size:12px;color:var(--muted);margin:16px 0}
.danger{color:#b91c1c;font-weight:900}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
  <span class="badge">AI BET ASSIST</span>
  <h1>Eventi automatici ‚Ä¢ Multiple ‚Ä¢ Sistemi</h1>
  <p class="sub">
    Seleziona gli eventi gi√† pronti, aggiungili alla schedina e calcola multipla o sistema.
    <br><span class="small">Supporto informativo / intrattenimento. Nessuna garanzia. Gioca responsabilmente.</span>
  </p>

  <div class="actions">
    <a id="btnWhats" href="#" target="_blank">üí¨ WhatsApp</a>
    <a id="btnMaps" href="#" target="_blank">üìç Maps</a>
    <a id="btnCall" href="#">üìû Chiama</a>
  </div>
</div>

<div class="card">
  <h2>‚ö° Eventi consigliati (auto)</h2>
  <div class="small">Ultimo aggiornamento: <span id="upd">‚Äî</span></div>
  <div id="eventsBox" class="note">Caricamento eventi‚Ä¶</div>
</div>

<div class="card">
  <h2>üßæ La tua schedina</h2>
  <table class="table">
    <thead>
      <tr><th>Partita</th><th>Mercato</th><th>Quota</th><th>Azioni</th></tr>
    </thead>
    <tbody id="picksBody"></tbody>
  </table>
  <p id="emptyMsg" class="note">Nessuna selezione ancora. Aggiungi 2‚Äì6 eventi dalla lista sopra.</p>

  <div class="row" style="margin-top:10px">
    <div style="flex:1;min-width:220px">
      <label class="small">Stake totale (‚Ç¨)</label>
      <input id="stake" type="number" min="1" step="1" value="5" oninput="recalc()" style="width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);font-size:15px;margin-top:6px">
    </div>
    <div style="flex:1;min-width:220px">
      <label class="small">Tipo giocata</label>
      <select id="playType" onchange="recalc()" style="width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);font-size:15px;margin-top:6px">
        <option value="multi">Multipla (tutte)</option>
        <option value="system">Sistema (2 su n)</option>
      </select>
    </div>
  </div>

  <p class="note">Nel ‚ÄúSistema (2 su n)‚Äù lo stake viene diviso sulle combinazioni da 2 eventi.</p>

  <div class="row" style="margin-top:10px">
    <button class="btnLight" onclick="clearAll()">üßπ Svuota</button>
  </div>

  <div class="note" id="calcOut"></div>
</div>

<div class="footer">¬© AI Bet Assist ‚Äì Demo</div>
</div>

<script>
// DATI CENTRO (poi li personalizziamo)
const PHONE_INTL = "39XXXXXXXXXX";
const PHONE_DISPLAY = "+39 XXX XXX XXXX";
const MAPS_LINK = "https://www.google.com/maps";
const WHATS_MSG = "Ciao! Ho scansionato il QR dal centro. Vorrei info su quote/orari.";

document.getElementById("btnWhats").href = "https://wa.me/" + PHONE_INTL + "?text=" + encodeURIComponent(WHATS_MSG);
document.getElementById("btnMaps").href = MAPS_LINK;
document.getElementById("btnCall").href = "tel:+" + PHONE_INTL;
document.getElementById("btnCall").innerText = "üìû " + PHONE_DISPLAY;

let picks = [];

function escapeHtml(str){
  return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}

function addToSlip(match, market, odd){
  picks.push({match, market, odd:Number(odd)});
  renderSlip(); recalc();
}
function removePick(i){ picks.splice(i,1); renderSlip(); recalc(); }
function clearAll(){ picks = []; renderSlip(); recalc(); }

function renderSlip(){
  const body = document.getElementById("picksBody");
  body.innerHTML = "";
  document.getElementById("emptyMsg").style.display = picks.length ? "none" : "block";
  picks.forEach((p,i)=>{
    const tr = document.createElement("tr");
    tr.className = "tr";
    tr.innerHTML = `
      <td><b>${escapeHtml(p.match)}</b></td>
      <td><span class="pill">${escapeHtml(p.market)}</span></td>
      <td><b>${Number(p.odd).toFixed(2)}</b></td>
      <td><button class="btnLight" onclick="removePick(${i})">‚ùå</button></td>
    `;
    body.appendChild(tr);
  });
}

function fmt2(n){ return "‚Ç¨" + (Math.round(n*100)/100).toFixed(2); }

// combinazioni 2 su n
function recalc(){
  const stake = Number(document.getElementById("stake").value || 0);
  const type = document.getElementById("playType").value;

  if(picks.length === 0){
    document.getElementById("calcOut").innerHTML = "";
    return;
  }

  if(type === "multi"){
    let odd = 1;
    picks.forEach(p=> odd *= p.odd);
    const win = stake * odd;
    document.getElementById("calcOut").innerHTML =
      `<b>Multipla:</b> Quota totale <b>${odd.toFixed(2)}</b> ‚Ä¢ Vincita stimata <b>${fmt2(win)}</b>`;
    return;
  }

  // sistema 2 su n
  const n = picks.length;
  const combos = (n*(n-1))/2;
  const unit = stake / combos;

  let minWin = Infinity;
  let maxWin = 0;
  for(let i=0;i<n;i++){
    for(let j=i+1;j<n;j++){
      const o = picks[i].odd * picks[j].odd;
      const w = unit * o;
      if(w < minWin) minWin = w;
      maxWin += w;
    }
  }

  document.getElementById("calcOut").innerHTML =
    `<b>Sistema (2 su n):</b> combinazioni <b>${combos}</b> ‚Ä¢ stake per combo <b>${fmt2(unit)}</b><br>
     Vincita MIN (1 combo): <b>${fmt2(minWin)}</b> ‚Ä¢ Vincita MAX (tutte combo): <b>${fmt2(maxWin)}</b>`;
}

async function loadEvents(){
  const box = document.getElementById("eventsBox");
  box.innerHTML = "Caricamento eventi‚Ä¶";
  try{
    const res = await fetch("./events.json?v=" + Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error("events.json non trovato");
    const data = await res.json();

    document.getElementById("upd").innerText = data.updated_at || "‚Äî";
    const ev = Array.isArray(data.events) ? data.events : [];
    if(!ev.length){
      box.innerHTML = "<span class='danger'>Nessun evento.</span>";
      return;
    }

    let html = "";
    ev.forEach(e=>{
      const match = `${e.home} - ${e.away}`;
      html += `
        <div class="card" style="margin:10px 0;box-shadow:none">
          <div class="pill">${escapeHtml(e.league || "")}</div>
          <div style="height:6px"></div>
          <b style="font-size:16px">${escapeHtml(match)}</b><br>
          <span class="small">${escapeHtml(e.start || "")}</span>
          <div style="height:10px"></div>
          <div class="row">
      `;
      (e.markets||[]).forEach(m=>{
        const label = m.label || "Mercato";
        const odd = Number(m.odd || 0).toFixed(2);
        html += `
          <div class="tr" style="padding:10px;border-radius:14px;border:1px solid var(--border);min-width:220px;flex:1">
            <div><b>${escapeHtml(label)}</b></div>
            <div class="small">Quota: <b>${odd}</b></div>
            <div style="height:8px"></div>
            <button class="btnLight" onclick="addToSlip('${escapeHtml(match)}','${escapeHtml(label)}',${odd})">‚ûï Aggiungi</button>
          </div>
        `;
      });
      html += `</div></div>`;
    });

    box.innerHTML = html;
  }catch(e){
    box.innerHTML = "<span class='danger'>Errore:</span> non riesco a leggere events.json. Controlla che sia nel repo.";
  }
}

renderSlip();
recalc();
loadEvents();
</script>

</body>
</html>
