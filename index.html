<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vincit√π ‚Ä¢ IA Portal</title>
  <style>
    :root{
      --bg1:#2b1457;
      --bg2:#0c2b36;
      --glass: rgba(20,22,30,.55);
      --glass2: rgba(20,22,30,.35);
      --stroke: rgba(255,255,255,.10);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --accent:#ff8a00;
      --accent2:#ffb000;
      --danger:#ff4a4a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      background:
        radial-gradient(1200px 700px at 20% 10%, rgba(140,70,255,.35), transparent 60%),
        radial-gradient(900px 600px at 85% 25%, rgba(0,220,255,.18), transparent 65%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    .wrap{max-width:1150px;margin:36px auto;padding:0 16px;}
    .shell{
      border:1px solid var(--stroke);
      border-radius:28px;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: 0 40px 120px rgba(0,0,0,.45);
      overflow:hidden;
      position:relative;
    }
    .shell::before{
      content:"";
      position:absolute;inset:-40px;
      background:
        radial-gradient(520px 340px at 15% 10%, rgba(255,120,0,.18), transparent 60%),
        radial-gradient(620px 420px at 90% 20%, rgba(255,0,140,.14), transparent 65%),
        radial-gradient(520px 420px at 55% 95%, rgba(0,210,255,.12), transparent 60%);
      filter: blur(10px);
      pointer-events:none;
    }

    .topbar{
      position:relative;
      display:flex;align-items:center;justify-content:space-between;
      padding:16px 18px;
      background: rgba(10,12,18,.35);
      border-bottom:1px solid var(--stroke);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex;align-items:center;gap:12px;min-width:260px;
    }
    .logoBadge{
      width:54px;height:38px;border-radius:10px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.45);
      display:flex;align-items:center;justify-content:center;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
      overflow:hidden;
    }
    .logoText{
      font-weight:900; letter-spacing:.4px;
      font-size:14px;
      color:#ff2a2a;
      text-transform:lowercase;
    }
    .brandTitle{
      display:flex;flex-direction:column;gap:2px;
    }
    .brandTitle b{font-size:16px}
    .brandTitle span{font-size:12px;color:var(--muted)}
    .chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .chip{
      display:flex;gap:8px;align-items:center;
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.22);
      color:var(--muted); font-size:12px;
    }
    .dot{width:8px;height:8px;border-radius:99px;background:#4cff7a;box-shadow:0 0 16px rgba(76,255,122,.35)}

    .grid{
      position:relative;
      display:grid;
      grid-template-columns: 1.35fr .9fr;
      gap:16px;
      padding:16px;
    }
    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
      .brand{min-width:auto}
    }

    .card{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(10,12,18,.35);
      border-radius:22px;
      padding:14px;
      backdrop-filter: blur(10px);
    }
    .card h3{
      margin:0 0 10px 0;
      font-size:14px;
      display:flex;align-items:center;justify-content:space-between;
      color:rgba(255,255,255,.88);
    }

    .toolbar{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
      margin-bottom:12px;
    }
    .btn{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color:rgba(255,255,255,.92);
      padding:10px 12px;
      border-radius:12px;
      font-weight:700;
      cursor:pointer;
      display:inline-flex;align-items:center;gap:8px;
    }
    .btnPrimary{
      background: linear-gradient(180deg, rgba(255,140,0,.95), rgba(255,105,0,.85));
      border-color: rgba(255,180,0,.45);
      color:#1b0f05;
      box-shadow: 0 18px 45px rgba(255,120,0,.25);
    }
    .btnGhost{
      background: rgba(0,0,0,.15);
    }
    .pill{
      font-size:12px;color:var(--muted);
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      display:inline-flex;gap:8px;align-items:center;
    }

    .event{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      border-radius:18px;
      padding:12px;
      margin-bottom:12px;
    }
    .eventHead{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-bottom:10px;
    }
    .leagueLine{
      display:flex;align-items:center;gap:10px;color:var(--muted);font-size:12px
    }
    .flag{
      width:22px;height:22px;border-radius:999px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
    }
    .teams{
      display:flex;align-items:center;gap:10px;font-weight:900
    }
    .teamBadge{
      width:28px;height:28px;border-radius:10px;
      display:grid;place-items:center;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.12);
      font-weight:900;
      color: rgba(255,255,255,.92);
      font-size:12px;
    }
    .meta{
      font-size:12px;color:var(--muted);
      display:flex;gap:10px;align-items:center;
    }

    .markets{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap:10px;
    }
    @media (max-width: 680px){
      .markets{grid-template-columns:1fr}
    }

    .market{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      border-radius:16px;
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .mTop{
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
    }
    .mLabel{font-weight:800;font-size:12px}
    .mHint{font-size:11px;color:var(--muted)}
    .mRow{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .oddBox{
      width:92px;
      text-align:center;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      font-weight:900;
    }
    .addBtn{
      flex:1;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(255,255,255,.92);
      font-weight:900;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;gap:8px;
      white-space:nowrap;
    }
    .addBtn:hover{border-color: rgba(255,180,0,.40); box-shadow: 0 0 0 2px rgba(255,140,0,.10) inset;}

    .right h3{margin-bottom:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.92);
      outline:none;
      font-weight:700;
    }
    .kpi{
      display:grid;grid-template-columns: repeat(3, 1fr);
      gap:10px;margin-top:10px;
    }
    .kpi .box{
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      border-radius:16px;
      padding:10px;
      color:var(--muted);
      font-size:12px;
    }
    .kpi .box b{display:block;color:rgba(255,255,255,.92);font-size:14px;margin-top:6px}
    .printBtn{
      width:100%;
      margin-top:12px;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid rgba(255,180,0,.45);
      background: linear-gradient(180deg, rgba(255,160,0,.95), rgba(255,110,0,.85));
      color:#1b0f05;
      font-weight:1000;
      cursor:pointer;
      box-shadow: 0 18px 45px rgba(255,120,0,.25);
    }
    .note{margin-top:10px;font-size:11px;color:rgba(255,255,255,.60);line-height:1.35}
    .err{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,74,74,.28);
      background: rgba(255,74,74,.10);
      color: rgba(255,220,220,.92);
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="shell">
      <div class="topbar">
        <div class="brand">
          <div class="logoBadge" aria-label="Vincit√π">
            <div class="logoText">vin<span style="color:#ffb000">ci</span>t√π</div>
          </div>
          <div class="brandTitle">
            <b>Vincit√π ‚Ä¢ IA Portal</b>
            <span>Eventi misti (top + minori) ‚Ä¢ fasce: mattina ‚Ä¢ pomeriggio ‚Ä¢ sera</span>
          </div>
        </div>

        <div class="chips">
          <div class="chip"><span class="dot"></span> Centro: <b id="centerChip" style="color:rgba(255,255,255,.92)">VINC001</b></div>
          <div class="chip">Agg.: <b id="updatedChip" style="color:rgba(255,255,255,.92)">‚Äî</b></div>
          <div class="chip">Fascia: <b id="slotChip" style="color:rgba(255,255,255,.92)">Mattina</b></div>
        </div>
      </div>

      <div class="grid">
        <div class="card left">
          <h3>‚ö° Eventi (IA) <span class="pill">Quote precompilate (poi correggi al banco)</span></h3>

          <div class="toolbar">
            <button class="btn btnPrimary" id="btnNew">üß† Nuovi eventi</button>
            <button class="btn btnGhost" id="btnSlot">üïí Cambia fascia</button>
            <span class="pill">Eventi mostrati: <b id="count">0</b>/5</span>
          </div>

          <div id="events"></div>
          <div id="err" class="err" style="display:none;"></div>

          <div class="note">Supporto informativo / intrattenimento. Nessuna garanzia. Gioca responsabilmente.</div>
        </div>

        <div class="card right">
          <h3>üßæ Schedina</h3>

          <div class="row">
            <div style="flex:1">
              <label style="font-size:12px;color:var(--muted)">Stake (‚Ç¨)</label>
              <input id="stake" class="input" type="number" value="5" min="1" step="1" />
            </div>
            <div style="flex:1">
              <label style="font-size:12px;color:var(--muted)">Tipo</label>
              <select id="type">
                <option value="multiple">Multipla (tutte)</option>
              </select>
            </div>
          </div>

          <div class="kpi">
            <div class="box">Selezioni<b id="kSel">0</b></div>
            <div class="box">Quota totale<b id="kOdd">‚Äî</b></div>
            <div class="box">Vincita pot.<b id="kWin">‚Äî</b></div>
          </div>

          <button class="printBtn" id="btnPrint">üñ®Ô∏è Stampa schedina</button>

          <div class="note">
            Se al banco vedi quote diverse, sostituiscile prima di confermare. In stampa usiamo la tua selezione.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  const qs = new URLSearchParams(location.search);
  const center = (qs.get("c") || "VINC001").toUpperCase();
  let slot = (qs.get("slot") || "morning").toLowerCase(); // morning | afternoon | evening
  let seed = parseInt(qs.get("v") || (Date.now() % 100000), 10);

  const slotLabel = (s)=> s==="morning" ? "Mattina" : s==="afternoon" ? "Pomeriggio" : "Sera";
  const flagEmoji = (cc)=>{
    const map = { IT:"üáÆüáπ", EN:"üè¥", ES:"üá™üá∏", FR:"üá´üá∑", DE:"üá©üá™", NL:"üá≥üá±", PT:"üáµüáπ", SE:"üá∏üá™", TR:"üáπüá∑", PL:"üáµüá±", GR:"üá¨üá∑", CH:"üá®üá≠" };
    return map[cc] || "üåç";
  };
  const code2 = (name)=>{
    const n = (name||"").replace(/[^A-Za-z√Ä-≈æ ]/g,"").trim().split(/\s+/);
    const a = (n[0]||"X")[0];
    const b = (n.length>1 ? n[n.length-1][0] : (n[0]||"Y")[1] || "Y");
    return (a+b).toUpperCase();
  };

  const elEvents = document.getElementById("events");
  const elErr = document.getElementById("err");

  document.getElementById("centerChip").textContent = center;
  document.getElementById("slotChip").textContent = slotLabel(slot);

  function mulberry32(a){
    return function(){
      let t = a += 0x6D2B79F5;
      t = Math.imul(t ^ t >>> 15, t | 1);
      t ^= t + Math.imul(t ^ t >>> 7, t | 61);
      return ((t ^ t >>> 14) >>> 0) / 4294967296;
    }
  }

  let selected = []; // {match, market, odd}

  function updateKPI(){
    const stake = parseFloat(document.getElementById("stake").value || "0");
    const totalOdd = selected.reduce((acc,x)=>acc*(x.odd||1), 1);
    document.getElementById("kSel").textContent = String(selected.length);
    document.getElementById("kOdd").textContent = selected.length ? totalOdd.toFixed(2) : "‚Äî";
    document.getElementById("kWin").textContent = selected.length ? (stake*totalOdd).toFixed(2) : "‚Äî";
  }

  function addPick(match, marketLabel, odd){
    selected.push({ match, market: marketLabel, odd });
    updateKPI();
  }

  function render(events, updatedAt){
    document.getElementById("updatedChip").textContent = updatedAt || "‚Äî";
    document.getElementById("count").textContent = String(events.length);

    elEvents.innerHTML = "";
    events.forEach((ev, idx)=>{
      const cc = (ev.country || "").toUpperCase();
      const flag = flagEmoji(cc);
      const home = ev.home, away = ev.away;

      const node = document.createElement("div");
      node.className = "event";
      node.innerHTML = `
        <div class="eventHead">
          <div>
            <div class="leagueLine">
              <span class="flag">${flag}</span>
              <b>${ev.league || "Campionato"}</b>
              <span style="opacity:.8">‚Ä¢</span>
              <span>${ev.start || ""}</span>
              <span style="opacity:.8">‚Ä¢</span>
              <span style="color:rgba(255,200,120,.95);font-weight:900">${slotLabel(ev.slot || slot)}</span>
            </div>
            <div class="teams" style="margin-top:8px">
              <span class="teamBadge">${code2(home)}</span>
              <span>${home} - ${away}</span>
              <span class="teamBadge">${code2(away)}</span>
            </div>
          </div>
          <div class="meta">Evento ${idx+1}/5</div>
        </div>

        <div class="markets"></div>
      `;

      const mk = node.querySelector(".markets");
      (ev.markets || []).slice(0,3).forEach(m=>{
        const mNode = document.createElement("div");
        mNode.className = "market";
        mNode.innerHTML = `
          <div class="mTop">
            <div>
              <div class="mLabel">${m.label || "Mercato"}</div>
              <div class="mHint">Quota precompilata (modificabile)</div>
            </div>
          </div>
          <div class="mRow">
            <div class="oddBox">${Number(m.odd || 1).toFixed(2)}</div>
            <button class="addBtn">‚ûï Aggiungi</button>
          </div>
        `;
        mNode.querySelector(".addBtn").addEventListener("click", ()=>{
          addPick(`${home} - ${away}`, m.label, Number(m.odd||1));
        });
        mk.appendChild(mNode);
      });

      elEvents.appendChild(node);
    });
  }

  async function load(){
    elErr.style.display = "none";
    try{
      const res = await fetch("events.json?ts=" + Date.now());
      const txt = await res.text();

      // Protezione: se qualcuno ha inserito roba non-JSON, lo segnaliamo chiaro
      let data;
      try{
        data = JSON.parse(txt);
      }catch(e){
        throw new Error("events.json non √® JSON valido. Apri events.json e incolla il file completo che ti ho dato (senza commenti).");
      }

      const all = Array.isArray(data.events) ? data.events : [];
      const filtered = all.filter(x => (x.slot||"").toLowerCase() === slot);

      // Se per qualche motivo la fascia √® vuota, mostra comunque 5 dal totale (misti)
      const base = filtered.length ? filtered : all;

      // Selezione 5 unici senza duplicati
      const rnd = mulberry32(seed);
      const used = new Set();
      const out = [];

      // Mescola indice
      const idxs = base.map((_,i)=>i);
      for(let i=idxs.length-1;i>0;i--){
        const j = Math.floor(rnd()*(i+1));
        [idxs[i], idxs[j]] = [idxs[j], idxs[i]];
      }

      for(const i of idxs){
        const ev = base[i];
        const key = `${ev.home}__${ev.away}__${ev.league}`;
        if(used.has(key)) continue;
        used.add(key);
        out.push(ev);
        if(out.length>=5) break;
      }

      render(out, data.updated_at);

    }catch(err){
      elEvents.innerHTML = "";
      elErr.textContent = "Errore: " + (err?.message || String(err));
      elErr.style.display = "block";
    }
  }

  document.getElementById("btnNew").addEventListener("click", ()=>{
    seed = (seed + 1337) % 1000000;
    load();
  });

  document.getElementById("btnSlot").addEventListener("click", ()=>{
    slot = slot==="morning" ? "afternoon" : slot==="afternoon" ? "evening" : "morning";
    document.getElementById("slotChip").textContent = slotLabel(slot);
    // aggiorna URL senza ricaricare
    const u = new URL(location.href);
    u.searchParams.set("slot", slot);
    u.searchParams.set("v", String(seed));
    history.replaceState({}, "", u.toString());
    load();
  });

  document.getElementById("btnPrint").addEventListener("click", ()=>{
    alert("Stampa demo: qui poi mettiamo la stampa bella (PDF/receipt). Per ora calcola quota e vincita in alto.");
  });

  updateKPI();
  load();
</script>
</body>
</html>
