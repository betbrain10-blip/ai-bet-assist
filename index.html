<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vincitu ‚Ä¢ WOW Portal</title>
  <meta name="theme-color" content="#0b1220"/>

  <style>
    :root{
      --bg1:#070a12;
      --bg2:#101b32;
      --stroke: rgba(255,255,255,.10);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --muted2: rgba(255,255,255,.45);
      --accent:#34d399;
      --accent2:#60a5fa;
      --danger:#fb7185;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--txt);
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(124,58,237,.35), transparent 55%),
        radial-gradient(900px 700px at 80% 30%, rgba(56,189,248,.25), transparent 60%),
        radial-gradient(900px 900px at 50% 90%, rgba(34,197,94,.14), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{max-width:1180px;margin:0 auto;padding:26px 18px 40px;}

    .topbar{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      padding:18px;border:1px solid var(--stroke);
      background: rgba(10,15,28,.65);
      border-radius:20px;box-shadow:var(--shadow);backdrop-filter: blur(10px);
    }

    .brand{display:flex;align-items:center;gap:12px;min-width:280px;}

    /* LOGO WOW: pi√π visibile */
    .logoPill{
      display:flex;align-items:center;justify-content:center;
      padding:8px 10px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.18);
      border-radius:14px;
    }
    .brand img{
      height:48px;width:auto;
      filter: brightness(1.25) contrast(1.15) drop-shadow(0 10px 22px rgba(0,0,0,.55));
    }

    .brand h1{margin:0;font-size:18px;line-height:1.15;letter-spacing:.2px;font-weight:780;}
    .brand .sub{margin-top:4px;font-size:12px;color:var(--muted);}

    .chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;align-items:center;}
    .chip{padding:8px 10px;border:1px solid var(--stroke);background: rgba(255,255,255,.06);border-radius:999px;font-size:12px;color:var(--muted);}
    .chip b{color: var(--txt)}

    .grid{margin-top:18px;display:grid;grid-template-columns:1.2fr .8fr;gap:14px;}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} .brand{min-width:unset} }

    .card{
      border:1px solid var(--stroke);
      background: rgba(10,15,28,.55);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .cardHead{
      padding:14px;border-bottom:1px solid var(--stroke);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .cardHead h2{margin:0;font-size:14px;letter-spacing:.2px;}
    .cardBody{padding:14px}

    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    .btn{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);
      color: var(--txt);
      padding:10px 12px;border-radius:12px;font-weight:720;
      cursor:pointer;transition:.15s ease;user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.11)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(52,211,153,.95), rgba(96,165,250,.85));
      border-color: transparent;color:#041016;
    }
    .btn.danger{background: rgba(251,113,133,.14);border-color: rgba(251,113,133,.28);color:#ffd3da;}

    .pill{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid var(--stroke);background: rgba(255,255,255,.06);font-size:12px;color: var(--muted);}
    .dot{width:8px;height:8px;border-radius:50%;background: var(--accent);box-shadow: 0 0 0 5px rgba(52,211,153,.12);}
    .dot.blue{background: var(--accent2); box-shadow: 0 0 0 5px rgba(96,165,250,.12);}
    .dot.orange{background:#f59e0b; box-shadow: 0 0 0 5px rgba(245,158,11,.14);}

    .small{font-size:12px;color: var(--muted);}
    .tiny{font-size:11px;color: var(--muted2);}

    .events{display:flex;flex-direction:column;gap:12px;}
    .event{border:1px solid var(--stroke);background: rgba(255,255,255,.05);border-radius:16px;padding:12px;}
    .eventTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;margin-bottom:10px;}
    .leagueTag{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;background: rgba(255,255,255,.06);border:1px solid var(--stroke);font-size:12px;color: var(--muted);}
    .eventTitle{margin:8px 0 2px;font-size:16px;font-weight:820;letter-spacing:.2px;}
    .eventMeta{font-size:12px;color: var(--muted);}
    .badgeIA{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid var(--stroke);background: rgba(255,255,255,.06);font-size:12px;color: var(--muted);white-space:nowrap;}

    .markets{display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px;margin-top:10px;}
    @media (max-width:700px){ .markets{grid-template-columns:1fr} }

    .mkt{border:1px solid var(--stroke);background: rgba(0,0,0,.18);border-radius:14px;padding:10px;display:flex;flex-direction:column;gap:8px;min-height:112px;}
    .mktTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;}
    .mktName{font-weight:780;font-size:13px;line-height:1.15;}
    .mktHint{font-size:11px;color: var(--muted2);}

    .oddsLine{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:auto;}
    .oddsInput{
      width:110px;max-width:46%;
      padding:10px 10px;border-radius:12px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--txt);
      outline:none;font-weight:800;text-align:center;
    }
    .oddsInput::placeholder{color: rgba(255,255,255,.35)}
    .addBtn{
      flex:1;padding:10px 10px;border-radius:12px;border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);color: var(--txt);font-weight:800;cursor:pointer;transition:.15s ease;
    }
    .addBtn:hover{background: rgba(255,255,255,.12); transform: translateY(-1px)}

    .slipTable{width:100%;border-collapse:collapse;margin-top:10px;}
    .slipTable th,.slipTable td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,.08);font-size:12px;vertical-align:top;}
    .slipTable th{color: var(--muted); font-weight:800; text-align:left}
    .xBtn{border:1px solid rgba(251,113,133,.28);background: rgba(251,113,133,.12);color:#ffd3da;border-radius:10px;padding:6px 10px;cursor:pointer;font-weight:800;}

    .formGroup{display:grid;grid-template-columns: 1fr 1fr;gap:10px;margin-top:10px;}
    @media (max-width:700px){ .formGroup{grid-template-columns:1fr} }

    label{font-size:12px;color: var(--muted); font-weight:800;}
    select,input[type="number"],input[type="text"]{
      width:100%;padding:10px 10px;border-radius:12px;border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);color: var(--txt);outline:none;margin-top:6px;font-weight:750;
    }

    .kpis{display:grid;grid-template-columns: repeat(3, minmax(0,1fr));gap:10px;margin-top:12px;}
    .kpi{border:1px solid var(--stroke);background: rgba(255,255,255,.05);border-radius:14px;padding:12px;}
    .kpi .k{font-size:12px;color: var(--muted); font-weight:800}
    .kpi .v{margin-top:6px;font-size:18px;font-weight:900}

    .footerNote{margin-top:12px;font-size:11px;color: var(--muted2);line-height:1.35;}

    .linkRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;}
    .linkBtn{
      flex:1;min-width:140px;display:inline-flex;align-items:center;justify-content:center;gap:10px;
      padding:10px 12px;border-radius:12px;border:1px solid var(--stroke);
      background: rgba(255,255,255,.08);color: var(--txt);font-weight:820;text-decoration:none;
    }
    .linkBtn:hover{background: rgba(255,255,255,.12); transform: translateY(-1px)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logoPill">
          <img src="vincitu-stemma-256.png" alt="Vincitu" />
        </div>
        <div>
          <h1>Vincitu ‚Ä¢ WOW Portal</h1>
          <div class="sub">Eventi ‚ÄúWOW‚Äù + schedina ‚Ä¢ Quote gi√† precompilate (poi puoi correggerle dal banco)</div>
        </div>
      </div>

      <div class="chips">
        <div class="chip">Centro: <b id="chipCenter">VINC001</b></div>
        <div class="chip">Agg.: <b id="chipUpdated">AUTO</b></div>
        <div class="chip">Modalit√†: <b>VINCITU</b></div>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="cardHead">
          <h2>‚ö° Vincitu ‚Ä¢ Eventi (WOW)</h2>
          <div class="row">
            <button class="btn primary" id="btnReload">üîÑ WOW Casual (rigenera)</button>
            <button class="btn" id="btnMood">‚ú® Cambia mood</button>
          </div>
        </div>
        <div class="cardBody">
          <div class="row" style="margin-bottom:10px;">
            <span class="pill"><span class="dot" id="moodDot"></span> <b>Mood:</b> <span id="moodText">equilibrato</span></span>
            <span class="pill"><span class="dot blue"></span> Quote precompilate (modificabili)</span>
            <span class="tiny">Se al banco vedi una quota diversa: scrivila sopra e premi ‚ÄúAggiungi‚Äù.</span>
          </div>

          <div class="events" id="events"></div>

          <div class="footerNote">
            Supporto informativo / intrattenimento. Nessuna garanzia di risultato. Gioca responsabilmente. 18+.
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>üßæ Schedina</h2>
          <button class="btn danger" id="btnClear">üßπ Svuota</button>
        </div>
        <div class="cardBody">
          <div class="small" style="margin-bottom:6px;">Multipla o Sistema 2 su n (informativo)</div>

          <table class="slipTable">
            <thead>
              <tr>
                <th>Partita</th>
                <th>Mercato</th>
                <th>Quota</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="slipBody">
              <tr><td colspan="4" class="small">Nessuna selezione. Premi <b>Aggiungi</b> sugli eventi.</td></tr>
            </tbody>
          </table>

          <div class="formGroup">
            <div>
              <label>Stake totale (‚Ç¨)</label>
              <input type="number" id="stake" min="1" step="1" value="5"/>
            </div>
            <div>
              <label>Tipo giocata</label>
              <select id="betType">
                <option value="multi">Multipla (tutte)</option>
                <option value="system2">Sistema (2 su n)</option>
              </select>
            </div>
          </div>

          <div class="kpis">
            <div class="kpi">
              <div class="k">Numero selezioni</div>
              <div class="v" id="kSel">0</div>
            </div>
            <div class="kpi">
              <div class="k">Quota totale (multipla)</div>
              <div class="v" id="kOdd">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Vincita potenziale</div>
              <div class="v" id="kWin">‚Äî</div>
            </div>
          </div>

          <div class="linkRow">
            <a class="linkBtn" id="waBtn" href="#" target="_blank" rel="noopener">üí¨ WhatsApp</a>
            <a class="linkBtn" id="mapsBtn" href="#" target="_blank" rel="noopener">üìç Maps</a>
          </div>
          <div class="linkRow">
            <a class="linkBtn" id="telBtn" href="tel:+390000000000">üìû +39 000 000 0000</a>
          </div>

          <div class="tiny" style="margin-top:10px;">
            Code sala (QR): apri con <b>?c=VINC001</b> per cambiare contatti.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const CENTERS = {
  "VINC001": {
    name: "Vincitu ‚Ä¢ Centro Demo",
    phone: "+39 000 000 0000",
    whatsapp: "+390000000000",
    maps: "https://www.google.com/maps",
  }
};

const MOODS = [
  { key:"equilibrato", dot:"", label:"equilibrato" },
  { key:"aggressivo", dot:"orange", label:"aggressivo" },
  { key:"safe", dot:"blue", label:"prudente" },
];

let moodIndex = 0;
let allEvents = [];
let shownEvents = [];
let slip = [];

function qs(name){
  const url = new URL(window.location.href);
  return url.searchParams.get(name);
}
function fmt2(n){
  if (typeof n !== "number" || !isFinite(n)) return "‚Äî";
  return n.toFixed(2);
}

function setCenterFromQuery(){
  const code = (qs("c") || "VINC001").toUpperCase();
  const center = CENTERS[code] || CENTERS["VINC001"];
  document.getElementById("chipCenter").textContent = code;

  const wa = document.getElementById("waBtn");
  const maps = document.getElementById("mapsBtn");
  const tel = document.getElementById("telBtn");
  wa.href = `https://wa.me/${(center.whatsapp||"").replace(/\\D/g,"")}?text=${encodeURIComponent("Ciao! Ho visto il portale WOW. Info?")}`;
  maps.href = center.maps || "https://www.google.com/maps";
  tel.href = `tel:${center.phone || "+390000000000"}`;
  tel.textContent = `üìû ${center.phone || "+39 000 000 0000"}`;
}

function setMood(){
  const m = MOODS[moodIndex % MOODS.length];
  document.getElementById("moodText").textContent = m.label;
  const dot = document.getElementById("moodDot");
  dot.className = "dot" + (m.dot ? (" " + m.dot) : "");
}

async function loadEvents(){
  try{
    const res = await fetch("./events.json?v=" + Date.now(), {cache:"no-store"});
    const data = await res.json();
    document.getElementById("chipUpdated").textContent = (data.updated_at || "AUTO");
    allEvents = (data.events || []);
  }catch(e){
    allEvents = [];
  }
}

function pickWowEvents(){
  if(!allEvents.length){
    shownEvents = [];
    renderEvents();
    return;
  }

  const m = MOODS[moodIndex % MOODS.length].key;
  const arr = [...allEvents].sort(()=>Math.random()-0.5);
  shownEvents = arr.slice(0, 10).map(ev=>{
    const badge = (m==="aggressivo") ? "Alta energia (IA)" : (m==="safe" ? "Prudente (IA)" : "Equilibrato (IA)");
    return {...ev, badge};
  });

  renderEvents();
}

function renderEvents(){
  const root = document.getElementById("events");
  root.innerHTML = "";

  if(!shownEvents.length){
    root.innerHTML = `<div class="small">Nessun evento caricato. Controlla che <b>events.json</b> esista nel repo.</div>`;
    return;
  }

  for(const ev of shownEvents){
    const title = `${ev.home} - ${ev.away}`;
    const when = ev.start || "‚Äî";
    const league = ev.league || "Campionato";

    const el = document.createElement("div");
    el.className = "event";

    el.innerHTML = `
      <div class="eventTop">
        <div>
          <span class="leagueTag">üü¢ ${league}</span>
          <div class="eventTitle">${title}</div>
          <div class="eventMeta">üïí ${when} ‚Ä¢ <span class="tiny">${(ev.tags||[]).join(" ‚Ä¢ ")}</span></div>
          ${ev.note ? `<div class="tiny" style="margin-top:6px;">‚ÑπÔ∏è ${ev.note}</div>` : ""}
        </div>
        <div class="badgeIA">‚ú® ${ev.badge || "IA"}</div>
      </div>

      <div class="markets">
        ${(ev.markets||[]).map(mk => `
          <div class="mkt" data-ev="${encodeURIComponent(title)}" data-mk="${encodeURIComponent(mk.label)}">
            <div class="mktTop">
              <div>
                <div class="mktName">${mk.label}</div>
                <div class="mktHint">${mk.tip || "Quota precompilata (modifica se diversa al banco)"}</div>
              </div>
            </div>
            <div class="oddsLine">
              <input class="oddsInput" type="text" inputmode="decimal" data-odd value="${mk.odd ? String(mk.odd).replace('.', ',') : ''}" placeholder="es. 1,72" />
              <button class="addBtn" data-add>Ôºã Aggiungi</button>
            </div>
          </div>
        `).join("")}
      </div>
    `;

    root.appendChild(el);
  }

  root.querySelectorAll("[data-add]").forEach(btn=>{
    btn.addEventListener("click", (e)=>{
      const box = e.target.closest(".mkt");
      const match = decodeURIComponent(box.getAttribute("data-ev"));
      const market = decodeURIComponent(box.getAttribute("data-mk"));
      const input = box.querySelector("[data-odd]");
      const raw = (input.value || "").trim().replace(",", ".");
      const odd = parseFloat(raw);

      if(!isFinite(odd) || odd < 1.01){
        input.focus();
        input.style.borderColor = "rgba(251,113,133,.55)";
        setTimeout(()=> input.style.borderColor = "rgba(255,255,255,.10)", 800);
        return;
      }

      slip.push({match, market, odd});
      renderSlip();
    });
  });
}

function renderSlip(){
  const body = document.getElementById("slipBody");
  body.innerHTML = "";

  if(!slip.length){
    body.innerHTML = `<tr><td colspan="4" class="small">Nessuna selezione. Premi <b>Aggiungi</b> sugli eventi.</td></tr>`;
    updateKPIs();
    return;
  }

  slip.forEach((s, i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${s.match}</td>
      <td>${s.market}</td>
      <td><b>${fmt2(s.odd)}</b></td>
      <td><button class="xBtn" data-del="${i}">X</button></td>
    `;
    body.appendChild(tr);
  });

  body.querySelectorAll("[data-del]").forEach(b=>{
    b.addEventListener("click", ()=>{
      const idx = parseInt(b.getAttribute("data-del"),10);
      slip.splice(idx,1);
      renderSlip();
    });
  });

  updateKPIs();
}

function updateKPIs(){
  const sel = slip.length;
  document.getElementById("kSel").textContent = sel;

  const stake = parseFloat(document.getElementById("stake").value || "0") || 0;
  const betType = document.getElementById("betType").value;

  if(sel === 0 || stake <= 0){
    document.getElementById("kOdd").textContent = "‚Äî";
    document.getElementById("kWin").textContent = "‚Äî";
    return;
  }

  let totalOdd = slip.reduce((acc, s)=> acc * s.odd, 1);

  if(betType === "multi"){
    document.getElementById("kOdd").textContent = fmt2(totalOdd);
    document.getElementById("kWin").textContent = "‚Ç¨" + fmt2(stake * totalOdd);
    return;
  }

  if(sel < 2){
    document.getElementById("kOdd").textContent = "‚Äî";
    document.getElementById("kWin").textContent = "‚Äî";
    return;
  }

  const combos = (sel * (sel - 1)) / 2;
  const stakePer = stake / combos;

  let payoutSum = 0;
  for(let i=0;i<sel;i++){
    for(let j=i+1;j<sel;j++){
      payoutSum += stakePer * (slip[i].odd * slip[j].odd);
    }
  }
  document.getElementById("kOdd").textContent = `Sistema 2 su ${sel} (${combos} combo)`;
  document.getElementById("kWin").textContent = "‚Ç¨" + fmt2(payoutSum);
}

function wire(){
  document.getElementById("btnClear").addEventListener("click", ()=>{
    slip = [];
    renderSlip();
  });

  document.getElementById("btnMood").addEventListener("click", ()=>{
    moodIndex++;
    setMood();
    pickWowEvents();
  });

  document.getElementById("btnReload").addEventListener("click", ()=>{
    pickWowEvents();
  });

  document.getElementById("stake").addEventListener("input", updateKPIs);
  document.getElementById("betType").addEventListener("change", updateKPIs);
}

(async function init(){
  setCenterFromQuery();
  wire();
  setMood();
  await loadEvents();
  pickWowEvents();
  renderSlip();
})();
</script>
</body>
</html>
