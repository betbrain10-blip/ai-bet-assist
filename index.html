<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Bet Assist ‚Ä¢ Futuristico</title>
<style>
:root{
  --bgA:#070A12;
  --bgB:#0B1022;
  --card:#0F1633;
  --card2:#0B122B;
  --border:rgba(255,255,255,.10);
  --ink:#EAF0FF;
  --muted:#A8B3D6;
  --good:#22c55e;
  --warn:#f59e0b;
  --bad:#ef4444;
  --grad:linear-gradient(90deg,#7c3aed,#06b6d4,#22c55e);
  --grad2:linear-gradient(135deg,#111a3a,#0f1633,#101b41);
  --shadow:0 18px 40px rgba(0,0,0,.45);
  --r:18px;
  --r2:14px;
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--ink);
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,.35), transparent 60%),
    radial-gradient(900px 500px at 90% 20%, rgba(6,182,212,.25), transparent 60%),
    radial-gradient(900px 500px at 30% 90%, rgba(34,197,94,.18), transparent 55%),
    linear-gradient(180deg,var(--bgA),var(--bgB));
}
.wrap{max-width:980px;margin:auto;padding:18px}
.topbar{
  display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
  padding:14px 16px;border:1px solid var(--border);border-radius:22px;background:rgba(255,255,255,.04);
  box-shadow:var(--shadow); backdrop-filter: blur(10px);
}
.brand{
  display:flex;align-items:center;gap:12px;min-width:240px;
}
.logo{
  width:44px;height:44px;border-radius:14px;
  background:conic-gradient(from 210deg,#7c3aed,#06b6d4,#22c55e,#7c3aed);
  box-shadow:0 10px 20px rgba(0,0,0,.35);
  position:relative;overflow:hidden;
}
.logo::after{
  content:"";position:absolute;inset:-20px;
  background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 55%);
  transform:rotate(15deg);
}
h1{margin:0;font-size:16px;letter-spacing:.3px}
.sub{margin:2px 0 0;color:var(--muted);font-size:12px;line-height:1.35}
.pill{
  display:inline-flex;align-items:center;gap:8px;
  padding:8px 12px;border-radius:999px;border:1px solid var(--border);
  background:rgba(255,255,255,.03); color:var(--muted);
  font-size:12px;font-weight:800;
}
.pill b{color:var(--ink)}
.grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
@media(min-width:860px){ .grid{grid-template-columns: 1.15fr .85fr;} }

.card{
  border:1px solid var(--border);
  border-radius:22px;
  background:var(--grad2);
  box-shadow:var(--shadow);
  overflow:hidden;
}
.cardHeader{
  padding:14px 16px;
  display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;
  background:rgba(255,255,255,.03);
}
.cardTitle{margin:0;font-size:14px}
.small{color:var(--muted);font-size:12px;line-height:1.35}
.section{padding:14px 16px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{
  cursor:pointer;
  border:none;
  padding:11px 14px;border-radius:14px;
  background:var(--grad);
  color:#06101b;
  font-weight:1000;
  letter-spacing:.2px;
}
.btn2{
  cursor:pointer;
  border:1px solid var(--border);
  padding:11px 14px;border-radius:14px;
  background:rgba(255,255,255,.04);
  color:var(--ink);
  font-weight:900;
}
.btnSm{padding:8px 10px;border-radius:12px;font-weight:900}
.input, select{
  width:100%;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.18);
  color:var(--ink);
  outline:none;
  font-size:14px;
}
label{font-size:12px;color:var(--muted);font-weight:900}
.kbd{
  font-family:var(--mono);
  font-size:12px;
  padding:6px 8px;border-radius:10px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  color:var(--muted);
}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{
  padding:9px 12px;border-radius:999px;border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  color:var(--muted);
  font-weight:1000;font-size:12px;cursor:pointer;
}
.tab.active{background:rgba(255,255,255,.10);color:var(--ink)}
.hr{height:1px;background:var(--border);margin:12px 0}
.tag{
  display:inline-flex;align-items:center;gap:8px;
  padding:7px 10px;border-radius:999px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.03);
  font-size:12px;font-weight:1000;color:var(--ink);
}
.dot{width:8px;height:8px;border-radius:999px;background:var(--good)}
.dot.w{background:var(--warn)}
.dot.r{background:var(--bad)}
.event{
  border:1px solid var(--border);
  border-radius:18px;
  padding:12px;
  background:rgba(255,255,255,.03);
  margin:10px 0;
}
.evTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:flex-start}
.evMatch{font-size:15px;font-weight:1000}
.evMeta{color:var(--muted);font-size:12px}
.marketGrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
@media(min-width:640px){ .marketGrid{grid-template-columns:1fr 1fr;} }
.market{
  border:1px solid var(--border);
  border-radius:16px;
  padding:10px;
  background:rgba(0,0,0,.14);
  display:flex;justify-content:space-between;gap:10px;align-items:center;
}
.market b{display:block}
.market .q{font-weight:1000}
.market .lab{color:var(--muted);font-size:12px}
.badgeIA{
  font-size:11px;font-weight:1000;color:rgba(234,240,255,.95);
  padding:6px 10px;border-radius:999px;
  border:1px solid var(--border);
  background:rgba(255,255,255,.05);
}
.badgeIA strong{color:#ffffff}
.table{width:100%;border-collapse:separate;border-spacing:0 10px}
.table th{text-align:left;color:var(--muted);font-size:12px;font-weight:1000;padding:0 8px}
.table td{padding:10px 8px;vertical-align:top}
.tr{
  background:rgba(255,255,255,.03);
  border:1px solid var(--border);
  border-radius:16px;
}
.footer{
  text-align:center;color:var(--muted);font-size:12px;margin:18px 0;
}
.notice{font-size:12px;color:var(--muted);line-height:1.35}
.notice b{color:var(--ink)}
</style>
</head>
<body>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1 id="centerName">AI Bet Assist ‚Ä¢ Demo Futuristica</h1>
        <div class="sub">Eventi automatici + Combo IA + Multiple & Sistemi ‚Ä¢ <span class="kbd">supporto informativo</span></div>
      </div>
    </div>

    <div class="row">
      <span class="pill">Centro: <b id="centerCodePill">DEMO</b></span>
      <span class="pill">Agg.: <b id="upd">‚Äî</b></span>
      <span class="pill">Modalit√†: <b id="modePill">AUTO</b></span>
    </div>
  </div>

  <div class="grid">
    <!-- COLONNA SINISTRA -->
    <div class="card">
      <div class="cardHeader">
        <div>
          <h2 class="cardTitle">‚ö° Eventi (auto) + Esperienza ‚ÄúFuturistica‚Äù</h2>
          <div class="small">Il cliente si diverte, aggiunge eventi e prova multipla o sistema. Quote: <b>prendi sempre quelle del banco</b>.</div>
        </div>
        <div class="tabs" id="bookTabs"></div>
      </div>

      <div class="section">
        <div class="row">
          <button class="btn" onclick="addComboIA()">ü§ñ Aggiungi Combo IA</button>
          <button class="btn2" onclick="shuffleFeel()">‚ú® Cambia ‚Äúmood‚Äù IA</button>
          <span class="tag"><span class="dot" id="dotMood"></span> <span id="moodText">Mood: equilibrato</span></span>
        </div>

        <div class="hr"></div>

        <div id="eventsBox" class="notice">Caricamento eventi‚Ä¶</div>

        <div class="hr"></div>

        <div class="notice">
          <b>Nota centro:</b> per SNAI/Vincitu il cliente pu√≤ inserire la quota che vede al banco, cos√¨ non ci sono mismatch.
          <br>Obiettivo: aumentare coinvolgimento + richieste al banco.
        </div>
      </div>
    </div>

    <!-- COLONNA DESTRA -->
    <div class="card">
      <div class="cardHeader">
        <div>
          <h2 class="cardTitle">üßæ La tua schedina</h2>
          <div class="small">Multipla o Sistema 2 su n. (Informativo)</div>
        </div>
        <button class="btn2 btnSm" onclick="clearAll()">üßπ Svuota</button>
      </div>

      <div class="section">
        <table class="table">
          <thead>
            <tr><th>Partita</th><th>Mercato</th><th>Quota</th><th></th></tr>
          </thead>
          <tbody id="picksBody"></tbody>
        </table>
        <div id="emptyMsg" class="notice">Nessuna selezione. Premi <b>Aggiungi</b> dagli eventi.</div>

        <div class="hr"></div>

        <div class="row">
          <div style="flex:1;min-width:210px">
            <label>Stake totale (‚Ç¨)</label>
            <input class="input" id="stake" type="number" min="1" step="1" value="5" oninput="recalc()">
          </div>
          <div style="flex:1;min-width:210px">
            <label>Tipo giocata</label>
            <select id="playType" onchange="recalc()">
              <option value="multi">Multipla (tutte)</option>
              <option value="system">Sistema (2 su n)</option>
            </select>
          </div>
        </div>

        <div class="hr"></div>

        <div id="calcOut" class="notice"></div>

        <div class="hr"></div>

        <div class="notice">
          <b>Codice Sala (QR personalizzato):</b><br>
          Apri con <span class="kbd">?c=SNAI001</span> oppure <span class="kbd">?c=VINC001</span> per cambiare contatti e stile del centro.
        </div>

        <div class="row" style="margin-top:10px">
          <a class="btn2" id="btnWhats" href="#" target="_blank" style="text-decoration:none">üí¨ WhatsApp</a>
          <a class="btn2" id="btnMaps" href="#" target="_blank" style="text-decoration:none">üìç Maps</a>
          <a class="btn2" id="btnCall" href="#" style="text-decoration:none">üìû Chiama</a>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">¬© AI Bet Assist ‚Ä¢ Demo Futuristica ‚Ä¢ Gioca responsabilmente</div>
</div>

<script>
/** ========= CONFIG & UTILS ========= **/
const DEFAULT_CENTER = {
  code: "DEMO",
  name: "AI Bet Assist ‚Ä¢ Demo Futuristica",
  phone_intl: "39XXXXXXXXXX",
  phone_display: "+39 XXX XXX XXXX",
  maps_link: "https://www.google.com/maps",
  whatsapp_msg: "Ciao! Ho scansionato il QR dal centro. Vorrei info su quote/orari.",
  theme: { }
};

const BOOKS = [
  { id:"SNAI", label:"SNAI", emoji:"üü¶" },
  { id:"VINCITU", label:"Vincitu", emoji:"üü•" },
  { id:"AUTO", label:"Auto", emoji:"‚ö°" }
];

let center = {...DEFAULT_CENTER};
let currentBook = "AUTO";
let picks = [];

const moods = [
  { t:"equilibrato", dot:"" },
  { t:"aggressivo", dot:"w" },
  { t:"prudente", dot:"" },
  { t:"high vibe", dot:"" }
];
let moodIdx = 0;

function qs(k){ return new URLSearchParams(location.search).get(k); }
function escapeHtml(str){
  return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function fmt2(n){ return "‚Ç¨" + (Math.round(n*100)/100).toFixed(2); }

/** ========= CENTER LOADING ========= **/
async function loadCenter(){
  const c = (qs("c") || "").trim();
  if(!c){ applyCenter(DEFAULT_CENTER); return; }
  try{
    const res = await fetch(`./centers/${encodeURIComponent(c)}.json?v=` + Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error("center json missing");
    const data = await res.json();
    applyCenter({...DEFAULT_CENTER, ...data, code: c});
  }catch(e){
    applyCenter(DEFAULT_CENTER);
  }
}
function applyCenter(data){
  center = data;
  document.getElementById("centerName").innerText = center.name || DEFAULT_CENTER.name;
  document.getElementById("centerCodePill").innerText = center.code || "DEMO";

  const phoneIntl = center.phone_intl || DEFAULT_CENTER.phone_intl;
  const phoneDisp = center.phone_display || DEFAULT_CENTER.phone_display;
  const maps = center.maps_link || DEFAULT_CENTER.maps_link;
  const wmsg = center.whatsapp_msg || DEFAULT_CENTER.whatsapp_msg;

  document.getElementById("btnWhats").href = "https://wa.me/" + phoneIntl + "?text=" + encodeURIComponent(wmsg);
  document.getElementById("btnMaps").href = maps;
  document.getElementById("btnCall").href = "tel:+" + phoneIntl;
  document.getElementById("btnCall").innerText = "üìû " + phoneDisp;
}

/** ========= TABS ========= **/
function renderTabs(){
  const box = document.getElementById("bookTabs");
  box.innerHTML = "";
  BOOKS.forEach(b=>{
    const el = document.createElement("div");
    el.className = "tab" + (currentBook===b.id ? " active" : "");
    el.innerText = `${b.emoji} ${b.label}`;
    el.onclick = ()=>{ currentBook=b.id; document.getElementById("modePill").innerText = b.id; renderTabs(); loadEvents(); };
    box.appendChild(el);
  });
}

/** ========= EVENTS ========= **/
function feelTag(){
  // etichetta ‚ÄúIA‚Äù (solo intrattenimento)
  const mood = moods[moodIdx].t;
  if(mood==="aggressivo") return {txt:"üî• Alta energia (IA)", cls:"badgeIA", dot:"w"};
  if(mood==="prudente") return {txt:"üõ°Ô∏è Prudente (IA)", cls:"badgeIA", dot:""};
  if(mood==="high vibe") return {txt:"‚ú® Trend positivo (IA)", cls:"badgeIA", dot:""};
  return {txt:"üìä Equilibrato (IA)", cls:"badgeIA", dot:""};
}
function shuffleFeel(){
  moodIdx = (moodIdx + 1) % moods.length;
  const m = moods[moodIdx];
  document.getElementById("moodText").innerText = "Mood: " + m.t;
  document.getElementById("dotMood").className = "dot " + (m.dot || "");
  loadEvents();
}

async function loadEvents(){
  const box = document.getElementById("eventsBox");
  box.innerHTML = "Caricamento eventi‚Ä¶";
  try{
    // Auto: usa events.json (generato dall‚Äôautomazione)
    // Snai/Vincitu: usa anche events.json, ma enfatizziamo che la quota va verificata al banco (il cliente pu√≤ editarla, vedi sotto)
    const res = await fetch("./events.json?v=" + Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error("events.json non trovato");
    const data = await res.json();
    document.getElementById("upd").innerText = data.updated_at || "‚Äî";

    const ev = Array.isArray(data.events) ? data.events : [];
    if(!ev.length){ box.innerHTML = "<span class='notice'><b>Nessun evento</b>.</span>"; return; }

    // Rotazione ‚Äúfuturistica‚Äù (client-side) in base all‚Äôorario: mattina 2, pomeriggio 3, sera 4
    const h = new Date().getHours();
    let take = 3;
    if(h < 12) take = 2;
    else if(h >= 18) take = 4;

    const sliced = ev.slice(0, take);

    const tag = feelTag();
    let html = "";
    sliced.forEach(e=>{
      const match = `${e.home} - ${e.away}`;
      html += `
        <div class="event">
          <div class="evTop">
            <div>
              <div class="tag"><span class="dot"></span> ${escapeHtml(e.league || "")}</div>
              <div style="height:6px"></div>
              <div class="evMatch">${escapeHtml(match)}</div>
              <div class="evMeta">${escapeHtml(e.start || "")}</div>
            </div>
            <div class="${tag.cls}"><strong>${escapeHtml(tag.txt)}</strong></div>
          </div>

          <div class="marketGrid">
      `;

      (e.markets||[]).forEach(m=>{
        const label = m.label || "Mercato";
        const odd = Number(m.odd || 0).toFixed(2);

        // Per Snai/Vincitu facciamo inserire la quota reale al banco (editabile al volo)
        const editable = (currentBook==="SNAI" || currentBook==="VINCITU");
        html += `
          <div class="market">
            <div>
              <b>${escapeHtml(label)}</b>
              <div class="lab">Quota ${editable ? " (inserisci quella del banco)" : ""}</div>
            </div>
            <div style="text-align:right">
              ${editable
                ? `<input class="input" style="max-width:110px;padding:9px 10px;border-radius:12px;font-weight:1000" id="q_${escapeHtml(match)}_${escapeHtml(label)}" value="${odd}">`
                : `<div class="q">${odd}</div>`
              }
              <div style="height:8px"></div>
              <button class="btn2 btnSm" onclick="addFromEvent('${escapeHtml(match)}','${escapeHtml(label)}','${odd}')">‚ûï Aggiungi</button>
            </div>
          </div>
        `;
      });

      html += `</div></div>`;
    });

    // info per book
    if(currentBook==="SNAI" || currentBook==="VINCITU"){
      html = `
        <div class="notice">
          <b>Modalit√† ${currentBook}:</b> Inserisci la quota che vedi al banco (campo editabile) e poi premi <b>Aggiungi</b>.
          <br>Cos√¨ trovi sempre le stesse quote del centro.
        </div>
        <div class="hr"></div>
      ` + html;
    }

    box.innerHTML = html;

    // aggiorna dot mood
    const m = moods[moodIdx];
    document.getElementById("dotMood").className = "dot " + (m.dot || "");

  }catch(e){
    box.innerHTML = "<span class='notice'><b>Errore:</b> non riesco a leggere events.json. Controlla che sia nel repo.</span>";
  }
}

function addFromEvent(match, market, defaultOdd){
  let odd = Number(defaultOdd);
  const editable = (currentBook==="SNAI" || currentBook==="VINCITU");
  if(editable){
    const id = `q_${match}_${market}`;
    const el = document.getElementById(id);
    if(el) odd = Number(el.value || defaultOdd);
  }
  if(!odd || odd <= 1){ alert("Quota non valida. Inserisci la quota reale del banco."); return; }
  addToSlip(match, market, odd);
}

/** ========= COMBO IA ========= **/
function addComboIA(){
  // Combo ‚Äúintrattenimento‚Äù: prende 2 mercati dai primi 2 eventi visibili
  const cards = document.querySelectorAll(".event");
  if(cards.length < 2){ alert("Servono almeno 2 eventi."); return; }

  // Prendiamo il primo mercato del primo evento e del secondo evento
  const firstMarketBtn = cards[0].querySelector(".btn2");
  const secondMarketBtn = cards[1].querySelector(".btn2");
  if(firstMarketBtn) firstMarketBtn.click();
  if(secondMarketBtn) secondMarketBtn.click();
}

/** ========= SLIP ========= **/
function addToSlip(match, market, odd){
  picks.push({match, market, odd:Number(odd)});
  renderSlip(); recalc();
}
function removePick(i){ picks.splice(i,1); renderSlip(); recalc(); }
function clearAll(){ picks = []; renderSlip(); recalc(); }

function renderSlip(){
  const body = document.getElementById("picksBody");
  body.innerHTML = "";
  document.getElementById("emptyMsg").style.display = picks.length ? "none" : "block";
  picks.forEach((p,i)=>{
    const tr = document.createElement("tr");
    tr.className = "tr";
    tr.innerHTML = `
      <td><b>${escapeHtml(p.match)}</b></td>
      <td><span class="pill">${escapeHtml(p.market)}</span></td>
      <td><b>${Number(p.odd).toFixed(2)}</b></td>
      <td><button class="btn2 btnSm" onclick="removePick(${i})">‚ùå</button></td>
    `;
    body.appendChild(tr);
  });
}

function recalc(){
  const stake = Number(document.getElementById("stake").value || 0);
  const type = document.getElementById("playType").value;

  if(picks.length === 0){
    document.getElementById("calcOut").innerHTML = "";
    return;
  }

  if(type === "multi"){
    let odd = 1;
    picks.forEach(p=> odd *= p.odd);
    const win = stake * odd;
    document.getElementById("calcOut").innerHTML =
      `<b>Multipla:</b> quota totale <b>${odd.toFixed(2)}</b> ‚Ä¢ vincita stimata <b>${fmt2(win)}</b>`;
    return;
  }

  // sistema 2 su n
  const n = picks.length;
  if(n < 2){
    document.getElementById("calcOut").innerHTML = `<b>Sistema:</b> aggiungi almeno 2 selezioni.`;
    return;
  }
  const combos = (n*(n-1))/2;
  const unit = stake / combos;

  let minWin = Infinity;
  let maxWin = 0;
  for(let i=0;i<n;i++){
    for(let j=i+1;j<n;j++){
      const o = picks[i].odd * picks[j].odd;
      const w = unit * o;
      if(w < minWin) minWin = w;
      maxWin += w;
    }
  }

  document.getElementById("calcOut").innerHTML =
    `<b>Sistema (2 su n):</b> combinazioni <b>${combos}</b> ‚Ä¢ stake per combo <b>${fmt2(unit)}</b><br>
     Vincita MIN (1 combo): <b>${fmt2(minWin)}</b> ‚Ä¢ Vincita MAX (tutte combo): <b>${fmt2(maxWin)}</b>`;
}

/** ========= INIT ========= **/
renderTabs();
renderSlip();
recalc();
loadCenter().then(()=> loadEvents());
</script>
</body>
</html>
