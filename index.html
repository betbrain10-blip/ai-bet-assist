<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Vincitu ‚Ä¢ AI Bet Assist (WOW)</title>
<style>
:root{
  --bgA:#070A12; --bgB:#0B1022;
  --border:rgba(255,255,255,.10);
  --ink:#EAF0FF; --muted:#A8B3D6;
  --grad:linear-gradient(90deg,#ef4444,#f59e0b,#22c55e);
  --shadow:0 18px 40px rgba(0,0,0,.45);
}
*{box-sizing:border-box}
body{
  margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--ink);
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(239,68,68,.22), transparent 60%),
    radial-gradient(900px 500px at 90% 20%, rgba(245,158,11,.20), transparent 60%),
    radial-gradient(900px 500px at 30% 90%, rgba(34,197,94,.16), transparent 55%),
    linear-gradient(180deg,var(--bgA),var(--bgB));
}
.wrap{max-width:980px;margin:auto;padding:18px}
.topbar{
  display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;
  padding:14px 16px;border:1px solid var(--border);border-radius:22px;
  background:rgba(255,255,255,.04);box-shadow:var(--shadow);backdrop-filter: blur(10px);
}
.brand{display:flex;align-items:center;gap:12px;min-width:280px}
.logo{
  width:44px;height:44px;border-radius:14px;background:conic-gradient(from 210deg,#ef4444,#f59e0b,#22c55e,#ef4444);
  box-shadow:0 10px 20px rgba(0,0,0,.35);
}
h1{margin:0;font-size:16px}
.sub{margin:2px 0 0;color:var(--muted);font-size:12px}
.pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--muted);font-size:12px;font-weight:900}
.pill b{color:var(--ink)}
.grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
@media(min-width:860px){ .grid{grid-template-columns: 1.15fr .85fr;} }
.card{border:1px solid var(--border);border-radius:22px;background:rgba(255,255,255,.03);box-shadow:var(--shadow);overflow:hidden}
.cardHeader{padding:14px 16px;display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;background:rgba(255,255,255,.03)}
.cardTitle{margin:0;font-size:14px}
.small{color:var(--muted);font-size:12px;line-height:1.35}
.section{padding:14px 16px}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.btn{cursor:pointer;border:none;padding:11px 14px;border-radius:14px;background:var(--grad);color:#06101b;font-weight:1000}
.btn2{cursor:pointer;border:1px solid var(--border);padding:11px 14px;border-radius:14px;background:rgba(255,255,255,.04);color:var(--ink);font-weight:900}
.btnSm{padding:8px 10px;border-radius:12px;font-weight:900}
.input, select{width:100%;padding:12px;border-radius:14px;border:1px solid var(--border);background:rgba(0,0,0,.18);color:var(--ink);outline:none;font-size:14px}
label{font-size:12px;color:var(--muted);font-weight:900}
.hr{height:1px;background:var(--border);margin:12px 0}
.tag{display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);font-size:12px;font-weight:1000}
.dot{width:8px;height:8px;border-radius:999px;background:#22c55e}
.dot.w{background:#f59e0b}
.dot.r{background:#ef4444}
.event{border:1px solid var(--border);border-radius:18px;padding:12px;background:rgba(255,255,255,.03);margin:10px 0}
.evTop{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:flex-start}
.evMatch{font-size:15px;font-weight:1000}
.evMeta{color:var(--muted);font-size:12px}
.marketGrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
@media(min-width:640px){ .marketGrid{grid-template-columns:1fr 1fr;} }
.market{border:1px solid var(--border);border-radius:16px;padding:10px;background:rgba(0,0,0,.14);display:flex;justify-content:space-between;gap:10px;align-items:center}
.market .lab{color:var(--muted);font-size:12px}
.badgeIA{font-size:11px;font-weight:1000;color:rgba(234,240,255,.95);padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.05)}
.table{width:100%;border-collapse:separate;border-spacing:0 10px}
.table th{text-align:left;color:var(--muted);font-size:12px;font-weight:1000;padding:0 8px}
.table td{padding:10px 8px;vertical-align:top}
.tr{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:16px}
.notice{font-size:12px;color:var(--muted);line-height:1.35}
.footer{text-align:center;color:var(--muted);font-size:12px;margin:18px 0}
</style>
</head>
<body>

<div class="wrap">
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1 id="centerName">Vincitu ‚Ä¢ WOW Portal</h1>
        <div class="sub">Eventi + schedina ‚Ä¢ Quote: inserisci sempre quelle del banco Vincitu</div>
      </div>
    </div>
    <div class="row">
      <span class="pill">Centro: <b id="centerCodePill">VINCITU</b></span>
      <span class="pill">Agg.: <b id="upd">‚Äî</b></span>
      <span class="pill">Modalit√†: <b>VINCITU</b></span>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="cardHeader">
        <div>
          <h2 class="cardTitle">üü• Vincitu ‚Ä¢ Eventi (WOW)</h2>
          <div class="small">Per ogni mercato inserisci la quota che vedi al banco e premi <b>Aggiungi</b>.</div>
        </div>
        <div class="row">
          <button class="btn" onclick="addComboWOW()">ü§ñ WOW Casual (2 eventi)</button>
          <button class="btn2" onclick="shuffleMood()">‚ú® Cambia mood</button>
        </div>
      </div>

      <div class="section">
        <div class="row">
          <span class="tag"><span class="dot" id="dotMood"></span> <span id="moodText">Mood: equilibrato</span></span>
          <span class="tag"><span class="dot w"></span> Quote inserite dal banco</span>
        </div>

        <div class="hr"></div>
        <div id="eventsBox" class="notice">Caricamento eventi‚Ä¶</div>

        <div class="hr"></div>
        <div class="notice">
          <b>Nota:</b> supporto informativo / intrattenimento. Quote indicative solo come esempio: <b>fa sempre fede il banco Vincitu</b>.
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardHeader">
        <div>
          <h2 class="cardTitle">üßæ Schedina</h2>
          <div class="small">Multipla o Sistema 2 su n</div>
        </div>
        <button class="btn2 btnSm" onclick="clearAll()">üßπ Svuota</button>
      </div>

      <div class="section">
        <table class="table">
          <thead><tr><th>Partita</th><th>Mercato</th><th>Quota</th><th></th></tr></thead>
          <tbody id="picksBody"></tbody>
        </table>
        <div id="emptyMsg" class="notice">Nessuna selezione. Premi <b>Aggiungi</b> sugli eventi.</div>

        <div class="hr"></div>

        <div class="row">
          <div style="flex:1;min-width:210px">
            <label>Stake totale (‚Ç¨)</label>
            <input class="input" id="stake" type="number" min="1" step="1" value="5" oninput="recalc()">
          </div>
          <div style="flex:1;min-width:210px">
            <label>Tipo giocata</label>
            <select id="playType" onchange="recalc()">
              <option value="multi">Multipla (tutte)</option>
              <option value="system">Sistema (2 su n)</option>
            </select>
          </div>
        </div>

        <div class="hr"></div>
        <div id="calcOut" class="notice"></div>

        <div class="hr"></div>
        <div class="row" style="margin-top:10px">
          <a class="btn2" id="btnWhats" href="#" target="_blank" style="text-decoration:none">üí¨ WhatsApp</a>
          <a class="btn2" id="btnMaps" href="#" target="_blank" style="text-decoration:none">üìç Maps</a>
          <a class="btn2" id="btnCall" href="#" style="text-decoration:none">üìû Chiama</a>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">¬© Vincitu ‚Ä¢ AI Bet Assist (WOW)</div>
</div>

<script>
/** ====== CONFIG (domani personalizziamo i dati sala) ====== **/
const CENTER = {
  name: "Vincitu ‚Ä¢ WOW Portal",
  code: "VINCITU",
  phone_intl: "39XXXXXXXXXX",
  phone_display: "+39 XXX XXX XXXX",
  maps_link: "https://www.google.com/maps",
  whatsapp_msg: "Ciao! Ho scansionato il QR Vincitu. Vorrei info su quote/orari."
};

let picks = [];
let cachedEvents = [];

const moods = [
  { t:"equilibrato", dot:"" },
  { t:"prudente", dot:"" },
  { t:"aggressivo", dot:"w" },
  { t:"wow", dot:"w" }
];
let moodIdx = 0;

function escapeHtml(str){
  return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#039;");
}
function fmt2(n){ return "‚Ç¨" + (Math.round(n*100)/100).toFixed(2); }

function applyCenter(){
  document.getElementById("centerName").innerText = CENTER.name;
  document.getElementById("centerCodePill").innerText = CENTER.code;

  document.getElementById("btnWhats").href = "https://wa.me/" + CENTER.phone_intl + "?text=" + encodeURIComponent(CENTER.whatsapp_msg);
  document.getElementById("btnMaps").href = CENTER.maps_link;
  document.getElementById("btnCall").href = "tel:+" + CENTER.phone_intl;
  document.getElementById("btnCall").innerText = "üìû " + CENTER.phone_display;
}

function shuffleMood(){
  moodIdx = (moodIdx + 1) % moods.length;
  const m = moods[moodIdx];
  document.getElementById("moodText").innerText = "Mood: " + m.t;
  document.getElementById("dotMood").className = "dot " + (m.dot || "");
  renderEvents();
}

function moodBadgeText(){
  const m = moods[moodIdx].t;
  if(m==="aggressivo") return "üî• Alta energia (IA)";
  if(m==="prudente") return "üõ°Ô∏è Prudente (IA)";
  if(m==="wow") return "‚ú® WOW Explorer (IA)";
  return "üìä Equilibrato (IA)";
}
function pickCountByHour(){
  const h = new Date().getHours();
  if(h < 12) return 2;
  if(h < 18) return 3;
  return 4;
}
function shuffleArray(a){
  const arr = [...a];
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

async function loadEvents(){
  const box = document.getElementById("eventsBox");
  box.innerHTML = "Caricamento eventi‚Ä¶";
  try{
    const res = await fetch("./events.json?v=" + Date.now(), {cache:"no-store"});
    if(!res.ok) throw new Error("events.json non trovato");
    const data = await res.json();
    document.getElementById("upd").innerText = data.updated_at || "‚Äî";
    cachedEvents = Array.isArray(data.events) ? data.events : [];
    renderEvents();
  }catch(e){
    box.innerHTML = "Errore: non riesco a leggere events.json";
  }
}

function renderEvents(){
  const box = document.getElementById("eventsBox");
  if(!cachedEvents.length){
    box.innerHTML = "Nessun evento disponibile.";
    return;
  }

  // filtro campionati ‚Äúseri‚Äù
  const validLeagues = new Set([
    "Serie A","Serie B","Premier League","Championship",
    "LaLiga","Bundesliga","Ligue 1","Ligue 2",
    "Eredivisie","Primeira Liga",
    "Allsvenskan","Superliga","Ekstraklasa","Super League"
  ]);

  let ev = cachedEvents.filter(e => validLeagues.has(e.league));
  ev = shuffleArray(ev);

  const take = Math.min(pickCountByHour(), ev.length);
  const showEvents = ev.slice(0, take);
  const badge = moodBadgeText();

  let html = `
    <div class="notice">
      <b>Vincitu:</b> quota <b>sempre</b> inserita dal banco ‚Üí cos√¨ corrisponde al 100%.
    </div>
    <div class="hr"></div>
  `;

  showEvents.forEach(e=>{
    const match = `${e.home} - ${e.away}`;
    const tags = Array.isArray(e.tags) ? e.tags.slice(0,3) : [];
    const why = e.why ? e.why : "Selezione per intrattenimento: evento europeo reale o da palinsesto.";
    html += `
      <div class="event">
        <div class="evTop">
          <div>
            <div class="tag"><span class="dot"></span> ${escapeHtml(e.league || "")}</div>
            <div style="height:6px"></div>
            <div class="evMatch">${escapeHtml(match)}</div>
            <div class="evMeta">üïí ${escapeHtml(e.start || "")}</div>
          </div>
          <div class="badgeIA"><strong>${escapeHtml(badge)}</strong></div>
        </div>

        <div class="small" style="margin-top:8px">
          ${tags.map(t=>`<span class="tag" style="margin-right:6px"><span class="dot w"></span>${escapeHtml(t)}</span>`).join("")}
        </div>

        <div class="small" style="margin-top:8px">üß† <b>Perch√©:</b> ${escapeHtml(why)}</div>

        <div class="marketGrid">
    `;

    (e.markets||[]).forEach(m=>{
      const label = m.label || "Mercato";
      const oddDefault = Number(m.odd || 1.50).toFixed(2);
      const inputId = `q_${match}_${label}`.replaceAll(" ","_");

      html += `
        <div class="market">
          <div>
            <b>${escapeHtml(label)}</b>
            <div class="lab">Quota Vincitu (inserisci quella del banco)</div>
          </div>
          <div style="text-align:right">
            <input class="input" style="max-width:110px;padding:9px 10px;border-radius:12px;font-weight:1000"
                   id="${escapeHtml(inputId)}" value="${oddDefault}">
            <div style="height:8px"></div>
            <button class="btn2 btnSm" onclick="addFromEvent('${escapeHtml(match)}','${escapeHtml(label)}','${oddDefault}','${escapeHtml(inputId)}')">‚ûï Aggiungi</button>
          </div>
        </div>
      `;
    });

    html += `</div></div>`;
  });

  box.innerHTML = html;
}

function addFromEvent(match, market, defaultOdd, inputId){
  const el = document.getElementById(inputId);
  const odd = Number((el ? el.value : defaultOdd) || defaultOdd);
  if(!odd || odd <= 1){ alert("Quota non valida. Inserisci la quota reale Vincitu."); return; }
  addToSlip(match, market, odd);
}

function addComboWOW(){
  // Prende 2 eventi tra quelli validi: 1 TOP se presente + 1 Explorer
  const ev = cachedEvents.filter(e => e && e.league);
  if(ev.length < 2){ alert("Non ci sono abbastanza eventi."); return; }

  const top = ev.filter(e => String(e.tier||"").toUpperCase()==="TOP");
  const other = ev.filter(e => String(e.tier||"").toUpperCase()!=="TOP");

  const A = top[0] || ev[0];
  const B = other[0] || ev[1];

  const mA = (A.markets||[])[0];
  const mB = (B.markets||[])[0];

  if(mA) addToSlip(`${A.home} - ${A.away}`, mA.label || "Mercato", Number(mA.odd||1.50));
  if(mB) addToSlip(`${B.home} - ${B.away}`, mB.label || "Mercato", Number(mB.odd||1.50));
}

/** ====== SLIP ====== **/
function addToSlip(match, market, odd){
  picks.push({match, market, odd:Number(odd)});
  renderSlip(); recalc();
}
function removePick(i){ picks.splice(i,1); renderSlip(); recalc(); }
function clearAll(){ picks = []; renderSlip(); recalc(); }

function renderSlip(){
  const body = document.getElementById("picksBody");
  body.innerHTML = "";
  document.getElementById("emptyMsg").style.display = picks.length ? "none" : "block";
  picks.forEach((p,i)=>{
    const tr = document.createElement("tr");
    tr.className = "tr";
    tr.innerHTML = `
      <td><b>${escapeHtml(p.match)}</b></td>
      <td><span class="pill">${escapeHtml(p.market)}</span></td>
      <td><b>${Number(p.odd).toFixed(2)}</b></td>
      <td><button class="btn2 btnSm" onclick="removePick(${i})">‚ùå</button></td>
    `;
    body.appendChild(tr);
  });
}

function recalc(){
  const stake = Number(document.getElementById("stake").value || 0);
  const type = document.getElementById("playType").value;

  if(picks.length === 0){ document.getElementById("calcOut").innerHTML = ""; return; }

  if(type === "multi"){
    let odd = 1;
    picks.forEach(p=> odd *= p.odd);
    const win = stake * odd;
    document.getElementById("calcOut").innerHTML =
      `<b>Multipla:</b> quota totale <b>${odd.toFixed(2)}</b> ‚Ä¢ vincita stimata <b>${fmt2(win)}</b>`;
    return;
  }

  const n = picks.length;
  if(n < 2){ document.getElementById("calcOut").innerHTML = `<b>Sistema:</b> aggiungi almeno 2 selezioni.`; return; }
  const combos = (n*(n-1))/2;
  const unit = stake / combos;

  let minWin = Infinity;
  let maxWin = 0;
  for(let i=0;i<n;i++){
    for(let j=i+1;j<n;j++){
      const o = picks[i].odd * picks[j].odd;
      const w = unit * o;
      if(w < minWin) minWin = w;
      maxWin += w;
    }
  }

  document.getElementById("calcOut").innerHTML =
    `<b>Sistema (2 su n):</b> combinazioni <b>${combos}</b> ‚Ä¢ stake per combo <b>${fmt2(unit)}</b><br>
     Vincita MIN (1 combo): <b>${fmt2(minWin)}</b> ‚Ä¢ Vincita MAX (tutte combo): <b>${fmt2(maxWin)}</b>`;
}

/** ====== INIT ====== **/
applyCenter();
document.getElementById("dotMood").className = "dot";
loadEvents();
</script>
</body>
</html>
