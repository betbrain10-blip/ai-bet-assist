<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vincitu ‚Ä¢ IA Portal</title>
  <style>
    :root{
      --bg1:#0b0a14;
      --bg2:#0a1530;
      --card: rgba(18, 22, 38, .72);
      --card2: rgba(18, 22, 38, .55);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.18);
      --text:#e9ecff;
      --muted: rgba(233,236,255,.65);
      --chip: rgba(255,255,255,.08);
      --chip2: rgba(255,255,255,.12);
      --accent:#ffb020;
      --accent2:#7c5cff;
      --good:#2ee59d;
      --danger:#ff5c7a;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 15% 15%, rgba(124,92,255,.35), transparent 60%),
        radial-gradient(900px 650px at 85% 30%, rgba(255,176,32,.25), transparent 60%),
        radial-gradient(900px 650px at 80% 85%, rgba(46,229,157,.18), transparent 55%),
        linear-gradient(140deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }

    .wrap{
      max-width: 1120px;
      margin: 0 auto;
      padding: 26px 18px 40px;
    }

    .shell{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border-radius: 26px;
      padding: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 14px 14px 18px;
      border-radius: 20px;
      border: 1px solid var(--stroke);
      background: rgba(0,0,0,.18);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 260px;
    }

    /* LOGO SUPER VISIBILE */
    .logoBox{
      width: 56px;
      height: 56px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.10);
      border: 1px solid rgba(255,255,255,.22);
      box-shadow:
        0 10px 30px rgba(0,0,0,.35),
        0 0 0 3px rgba(255,255,255,.06),
        0 0 28px rgba(255,176,32,.22);
      overflow:hidden;
    }
    .logoBox img{
      width: 44px;
      height: 44px;
      object-fit: contain;
      filter: drop-shadow(0 6px 14px rgba(0,0,0,.55));
      transform: translateY(1px);
    }

    .brand h1{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
      line-height:1.15;
    }
    .brand p{
      margin:3px 0 0;
      font-size: 12px;
      color: var(--muted);
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      justify-content:flex-end;
    }
    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: var(--chip);
      font-size: 12px;
      color: var(--muted);
    }
    .dot{width:8px;height:8px;border-radius:99px;background:var(--good);box-shadow:0 0 12px rgba(46,229,157,.45)}
    .dot2{background:var(--accent);box-shadow:0 0 12px rgba(255,176,32,.35)}
    .dot3{background:var(--accent2);box-shadow:0 0 12px rgba(124,92,255,.35)}

    .grid{
      display:grid;
      grid-template-columns: 1.25fr .9fr;
      gap: 16px;
      padding: 16px 6px 6px;
    }

    @media (max-width: 980px){
      .grid{grid-template-columns: 1fr}
      .chips{justify-content:flex-start}
      .brand{min-width:auto}
    }

    .panel{
      border-radius: 22px;
      border:1px solid var(--stroke);
      background: var(--card);
      box-shadow: 0 14px 44px rgba(0,0,0,.34);
      overflow:hidden;
    }
    .panelHead{
      padding: 14px 16px;
      border-bottom:1px solid var(--stroke);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: rgba(0,0,0,.16);
    }
    .panelHead .title{
      display:flex; align-items:center; gap:10px;
      font-weight: 700;
      letter-spacing:.2px;
    }
    .panelHead small{color:var(--muted);font-weight:500}

    .btnRow{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.07);
      color: var(--text);
      border-radius: 12px;
      padding: 9px 12px;
      font-weight: 650;
      cursor:pointer;
      transition: .15s transform, .15s background;
      display:flex; align-items:center; gap:8px;
      user-select:none;
    }
    .btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.10)}
    .btn.primary{
      background: linear-gradient(135deg, rgba(124,92,255,.55), rgba(46,229,157,.35));
      border-color: rgba(255,255,255,.20);
    }
    .btn.warn{
      background: linear-gradient(135deg, rgba(255,176,32,.55), rgba(255,92,122,.12));
      border-color: rgba(255,255,255,.20);
    }

    .subtabs{
      padding: 12px 16px 0;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 9px 12px;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font-weight: 650;
    }
    .pill select{
      background: transparent;
      border:none;
      color: var(--text);
      font-weight: 700;
      outline:none;
      cursor:pointer;
    }

    .content{padding: 12px 14px 16px}

    .hint{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color: var(--muted);
      font-size: 12px;
      margin: 2px 0 12px;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-weight: 650;
    }

    .events{
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .event{
      border:1px solid var(--stroke);
      background: var(--card2);
      border-radius: 18px;
      padding: 12px 12px 10px;
    }

    .eventTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
      margin-bottom: 10px;
    }

    .eventMeta{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }

    .leagueTag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      color: rgba(233,236,255,.85);
      font-weight: 800;
      letter-spacing:.2px;
    }
    .flag{
      font-size: 15px;
      line-height: 1;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.35));
    }

    .eventName{
      font-size: 16px;
      font-weight: 900;
      letter-spacing:.2px;
      margin: 6px 0 2px;
    }
    .eventSub{color: var(--muted); font-size: 12px}

    .markets{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 760px){
      .markets{grid-template-columns: 1fr}
    }

    .mcard{
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.18);
      border-radius: 16px;
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap: 8px;
      min-height: 92px;
    }

    .mcard .mname{
      font-weight: 900;
      font-size: 12px;
      letter-spacing:.2px;
      color: rgba(233,236,255,.92);
    }

    .row{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .odds{
      width: 78px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      padding: 9px 10px;
      color: var(--text);
      font-weight: 900;
      text-align:center;
      outline:none;
    }

    .add{
      flex:1;
      border-radius: 12px;
      padding: 10px 10px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      font-weight: 900;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
    }
    .add:hover{background: rgba(255,255,255,.12)}
    .note{
      font-size: 11px;
      color: var(--muted);
      line-height: 1.25;
    }

    /* SLIP */
    .slipBody{padding: 12px 14px 16px}
    .slipTop{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .slipTop input, .slipTop select{
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.07);
      color: var(--text);
      padding: 10px 10px;
      font-weight: 800;
      outline:none;
    }
    .mini{
      font-size: 12px; color: var(--muted);
    }

    table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      margin-top: 10px;
    }
    th,td{
      padding: 10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-size: 12px;
      color: rgba(233,236,255,.88);
      text-align:left;
      vertical-align:top;
    }
    th{color: var(--muted); font-weight: 900; letter-spacing:.2px}
    tr:last-child td{border-bottom:none}
    .xbtn{
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      border-radius: 10px;
      padding: 6px 9px;
      cursor:pointer;
      font-weight: 900;
    }

    .cta{
      margin-top: 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .bigbtn{
      width: 100%;
      border:none;
      background: linear-gradient(135deg, rgba(255,176,32,.95), rgba(255,176,32,.55));
      color: #19140a;
      font-weight: 1000;
      letter-spacing:.3px;
      border-radius: 14px;
      padding: 12px 14px;
      cursor:pointer;
      box-shadow: 0 14px 36px rgba(255,176,32,.18);
    }

    .foot{
      margin-top: 12px;
      color: var(--muted);
      font-size: 11px;
      line-height: 1.35;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">
      <div class="topbar">
        <div class="brand">
          <div class="logoBox" title="Vincitu">
            <img src="vincitu-stemma-256.png" alt="Vincitu logo">
          </div>
          <div>
            <h1>Vincitu ‚Ä¢ IA Portal</h1>
            <p>Eventi + schedina ‚Ä¢ quote precompilate (puoi correggere dal banco)</p>
          </div>
        </div>

        <div class="chips" id="chips">
          <div class="chip"><span class="dot"></span> Centro: <b id="chipCenter">VINC001</b></div>
          <div class="chip"><span class="dot2"></span> Agg.: <b id="chipAgg">AUTO</b></div>
          <div class="chip"><span class="dot3"></span> Modalit√†: <b id="chipMode">VINCITU</b></div>
        </div>
      </div>

      <div class="grid">
        <!-- EVENTS -->
        <div class="panel">
          <div class="panelHead">
            <div class="title">‚ö° Vincitu ‚Ä¢ Eventi (IA)</div>
            <div class="btnRow">
              <button class="btn primary" id="regenBtn">üîÅ Rigenera</button>
              <button class="btn" id="moodBtn">‚ú® Cambia mood</button>
            </div>
          </div>

          <div class="subtabs">
            <span class="pill">Orizzonte
              <select id="horizon">
                <option value="oggi">Oggi</option>
                <option value="24h">24h</option>
                <option value="48h">48h</option>
              </select>
            </span>
            <span class="pill">Stile
              <select id="style">
                <option value="casual">Casual (IA)</option>
                <option value="sfida">Sfida IA</option>
                <option value="mix">Mix WOW</option>
              </select>
            </span>
            <span class="badge">‚úÖ Quote precompilate</span>
          </div>

          <div class="content">
            <div class="hint">
              <span class="badge">Se al banco vedi una quota diversa: modificaci sopra e premi ‚ÄúAggiungi‚Äù.</span>
            </div>

            <div class="events" id="events"></div>
          </div>
        </div>

        <!-- SLIP -->
        <div class="panel">
          <div class="panelHead">
            <div class="title">üßæ Schedina</div>
            <div class="btnRow">
              <button class="btn warn" id="clearBtn">üßπ Svuota</button>
            </div>
          </div>

          <div class="slipBody">
            <div class="slipTop">
              <div class="mini">Stake (‚Ç¨)</div>
              <input id="stake" type="number" value="5" min="1" step="1" style="width:90px">
              <div class="mini">Tipo</div>
              <select id="betType">
                <option value="multipla">Multipla (tutte)</option>
                <option value="system2">Sistema 2 su n</option>
              </select>
            </div>

            <table>
              <thead>
                <tr>
                  <th>Partita</th>
                  <th>Mercato</th>
                  <th>Quota</th>
                  <th>Az.</th>
                </tr>
              </thead>
              <tbody id="slipRows">
                <tr><td colspan="4" style="color:rgba(233,236,255,.6)">Nessuna selezione. Premi <b>Aggiungi</b> sugli eventi.</td></tr>
              </tbody>
            </table>

            <div class="cta">
              <button class="bigbtn" id="printBtn">üñ®Ô∏è Stampa schedina</button>
            </div>

            <div class="foot">
              Note: supporto informativo / intrattenimento. Nessuna garanzia. Gioca responsabilmente.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---- PARAMS ----
  const qs = new URLSearchParams(location.search);
  const center = (qs.get("c") || "VINC001").toUpperCase();
  const v = qs.get("v") || "";
  document.getElementById("chipCenter").textContent = center;

  // ---- LEAGUE -> FLAG ----
  function flagForLeague(league){
    const L = (league||"").toLowerCase();
    if (L.includes("serie") || L.includes("ital")) return "üáÆüáπ";
    if (L.includes("premier") || L.includes("eng")) return "üè¥";
    if (L.includes("laliga") || L.includes("spain") || L.includes("liga")) return "üá™üá∏";
    if (L.includes("bundes") || L.includes("german")) return "üá©üá™";
    if (L.includes("ligue") || L.includes("fran")) return "üá´üá∑";
    if (L.includes("erediv") || L.includes("oland")) return "üá≥üá±";
    if (L.includes("portog") || L.includes("primeira")) return "üáµüáπ";
    if (L.includes("belg")) return "üáßüá™";
    if (L.includes("svizz")) return "üá®üá≠";
    if (L.includes("turk")) return "üáπüá∑";
    if (L.includes("greek") || L.includes("grec")) return "üá¨üá∑";
    if (L.includes("polon")) return "üáµüá±";
    if (L.includes("svez") || L.includes("swed")) return "üá∏üá™";
    if (L.includes("norv")) return "üá≥üá¥";
    if (L.includes("dan")) return "üá©üá∞";
    if (L.includes("czech") || L.includes("ceca")) return "üá®üáø";
    if (L.includes("austr")) return "üá¶üáπ";
    return "üåç";
  }

  // ---- DATA ----
  async function loadData(){
    // prova: centers/<CENTER>.json (se esiste), altrimenti events.json
    const centerUrl = `centers/${center}.json`;
    const fallbackUrl = `events.json`;

    let data = null;
    try{
      const r = await fetch(centerUrl, {cache:"no-store"});
      if (r.ok) data = await r.json();
    }catch(e){}

    if(!data){
      const r2 = await fetch(fallbackUrl, {cache:"no-store"});
      data = await r2.json();
    }
    return data;
  }

  // ---- RENDER ----
  const eventsEl = document.getElementById("events");
  const slipRows = document.getElementById("slipRows");
  let slip = [];

  function renderSlip(){
    if(!slip.length){
      slipRows.innerHTML = `<tr><td colspan="4" style="color:rgba(233,236,255,.6)">Nessuna selezione. Premi <b>Aggiungi</b> sugli eventi.</td></tr>`;
      return;
    }
    slipRows.innerHTML = slip.map((s,i)=>`
      <tr>
        <td>${escapeHtml(s.match)}</td>
        <td><b>${escapeHtml(s.market)}</b></td>
        <td>${Number(s.odd).toFixed(2)}</td>
        <td><button class="xbtn" data-i="${i}">‚úï</button></td>
      </tr>
    `).join("");

    slipRows.querySelectorAll(".xbtn").forEach(b=>{
      b.addEventListener("click", ()=>{
        const i = Number(b.dataset.i);
        slip.splice(i,1);
        renderSlip();
      });
    });
  }

  function escapeHtml(str){
    return String(str||"").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function renderEvents(payload){
    const updated = payload.updated_at ? `Aggiornato: ${payload.updated_at}` : "Aggiornato: AUTO";
    document.getElementById("chipAgg").textContent = (payload.updated_at ? payload.updated_at : "AUTO");

    const list = payload.events || [];
    if(!list.length){
      eventsEl.innerHTML = `<div class="event">Nessun evento trovato.</div>`;
      return;
    }

    eventsEl.innerHTML = list.map((ev, idx)=>{
      const league = ev.league || "Campionato";
      const flag = flagForLeague(league);
      const match = `${ev.home || "Squadra A"} - ${ev.away || "Squadra B"}`;
      const when = ev.start || "Oggi";
      const markets = (ev.markets || []).slice(0,3);

      return `
        <div class="event">
          <div class="eventTop">
            <div>
              <div class="eventMeta">
                <span class="leagueTag"><span class="flag">${flag}</span>${escapeHtml(league)}</span>
                <span>üïí ${escapeHtml(when)}</span>
                <span style="opacity:.85">‚Ä¢ ${escapeHtml(updated)}</span>
              </div>
              <div class="eventName">${escapeHtml(match)}</div>
              <div class="eventSub">Seleziona una quota e aggiungi in schedina</div>
            </div>
          </div>

          <div class="markets">
            ${markets.map((m, mi)=>{
              const lbl = m.label || "Mercato";
              const odd = (m.odd ?? 1.70);
              const id = `odd_${idx}_${mi}`;
              return `
                <div class="mcard">
                  <div class="mname">${escapeHtml(lbl)}</div>
                  <div class="row">
                    <input class="odds" id="${id}" type="number" step="0.01" min="1.01" value="${Number(odd).toFixed(2)}">
                    <button class="add" data-match="${escapeHtml(match)}" data-market="${escapeHtml(lbl)}" data-oddid="${id}">
                      ‚ûï Aggiungi
                    </button>
                  </div>
                  <div class="note">Quota Vincitu (modificabile)</div>
                </div>
              `;
            }).join("")}
          </div>
        </div>
      `;
    }).join("");

    // bind add buttons
    eventsEl.querySelectorAll(".add").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const match = btn.dataset.match;
        const market = btn.dataset.market;
        const oddId = btn.dataset.oddid;
        const odd = Number(document.getElementById(oddId).value || "0");
        if(!odd || odd < 1.01) return;
        slip.push({match, market, odd});
        renderSlip();
      });
    });
  }

  // ---- ACTIONS ----
  document.getElementById("clearBtn").addEventListener("click", ()=>{
    slip = [];
    renderSlip();
  });

  document.getElementById("printBtn").addEventListener("click", ()=>{
    // stampa semplice
    window.print();
  });

  document.getElementById("regenBtn").addEventListener("click", async ()=>{
    // rigenera ‚Äúsoft‚Äù: ricarica JSON senza cache
    const data = await loadData();
    renderEvents(data);
  });

  document.getElementById("moodBtn").addEventListener("click", ()=>{
    // effetto ‚Äúmood‚Äù leggero: cambia accento del bottone (solo estetico)
    const btn = document.getElementById("regenBtn");
    btn.classList.toggle("warn");
    btn.classList.toggle("primary");
  });

  // ---- INIT ----
  (async ()=>{
    const data = await loadData();
    renderEvents(data);
    renderSlip();
  })();
</script>
</body>
</html>
